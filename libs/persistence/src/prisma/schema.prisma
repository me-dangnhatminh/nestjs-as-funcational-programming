datasource db {
  provider = "postgresql"
  url      = env("CONNECTION_STRING")
}

generator client {
  provider = "prisma-client-js"
}

enum UserRole {
  admin
  user
}

enum Provider {
  local
  google
}

model User {
  id         String    @id
  email      String?   @unique
  name       String?
  password   String?
  role       UserRole  @default(user)
  provider   Provider
  providerId String?
  verifiedAt DateTime? @db.Timestamp()

  firstName String?
  lastName  String?
  avatarUrl String?

  createdAt DateTime  @db.Timestamp()
  updatedAt DateTime? @db.Timestamp()
  removedAt DateTime? @db.Timestamp()
}

model FileRef {
  id   String @id
  name String
  size BigInt

  createdAt      DateTime
  lastModifiedAt DateTime?
  archivedAt     DateTime?

  ownerId     String
  contentType String
  thumbnail   String?
  description String?

  parent FileFolder?
}

model Folder {
  id   String @id
  name String
  size BigInt

  createdAt  DateTime
  archivedAt DateTime?

  ownerId String

  // nested set model and parent relation
  lft      Int     @default(0)
  rgt      Int     @default(0)
  parentId String?

  parent  Folder?  @relation("ParentFolder", fields: [parentId], references: [id])
  folders Folder[] @relation("ParentFolder")

  files FileFolder[]
}

model FileFolder {
  id String @id

  folderId String
  fileId   String @unique

  folder Folder  @relation(fields: [folderId], references: [id], onDelete: Cascade)
  file   FileRef @relation(fields: [fileId], references: [id], onDelete: Cascade)
}
